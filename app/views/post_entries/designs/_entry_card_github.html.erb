<%# app/views/post_entries/designs/_entry_card_github.html.erb %>
<%# GitHub Issues風デザイン - ステータスアイコン、ラベル、開発者向けUI %>

<%= turbo_frame_tag dom_id(entry) do %>
<article class="group" style="padding: 16px; border-bottom: 1px solid #d0d7de; transition: background-color 0.1s;"
         onmouseover="this.style.backgroundColor='#f6f8fa';"
         onmouseout="this.style.backgroundColor='transparent';">
  <div style="display: flex; align-items: flex-start; gap: 12px;">

    <%# ステータスアイコン（Open/Closed風） %>
    <div style="flex-shrink: 0; padding-top: 2px;">
      <% if entry.achieved? %>
        <%# 完了（紫のチェック） %>
        <div style="width: 20px; height: 20px; color: #8250df;" title="Completed">
          <svg viewBox="0 0 16 16" fill="currentColor">
            <path d="M11.28 6.78a.75.75 0 0 0-1.06-1.06L7.25 8.69 5.78 7.22a.75.75 0 0 0-1.06 1.06l2 2a.75.75 0 0 0 1.06 0l3.5-3.5Z"></path>
            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0Zm-1.5 0a6.5 6.5 0 1 0-13 0 6.5 6.5 0 0 0 13 0Z"></path>
          </svg>
        </div>
      <% else %>
        <%# 未完了（緑のオープン） %>
        <% if user_signed_in? && entry.user == current_user %>
          <%= button_to achieve_post_post_entry_path(entry.post, entry),
                method: :patch,
                class: "block",
                form: { data: { turbo_confirm: "「#{truncate(entry.content, length: 20)}」を達成しますか？" } } do %>
            <div style="width: 20px; height: 20px; color: #1a7f37; cursor: pointer;" title="Mark as completed">
              <svg viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"></path>
                <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"></path>
              </svg>
            </div>
          <% end %>
        <% else %>
          <div style="width: 20px; height: 20px; color: #1a7f37;" title="Open">
            <svg viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"></path>
              <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"></path>
            </svg>
          </div>
        <% end %>
      <% end %>
    </div>

    <%# メインコンテンツ %>
    <div style="flex: 1; min-width: 0;">
      <%# タイトル行 %>
      <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; margin-bottom: 6px;">
        <%= link_to post_path(entry.post), style: "font-size: 16px; font-weight: 600; color: <%= entry.achieved? ? '#656d76' : '#24292f' %>; text-decoration: none; line-height: 1.4; <%= 'text-decoration: line-through;' if entry.achieved? %>", data: { turbo_frame: "_top" },
              onmouseover: "this.style.color='#0969da'",
              onmouseout: "this.style.color='<%= entry.achieved? ? '#656d76' : '#24292f' %>'" do %>
          <%= entry.content %>
        <% end %>

        <%# ラベル（期限に応じたステータス） %>
        <% if entry.deadline.present? %>
          <%
            is_overdue = entry.deadline < Date.current && !entry.achieved?
            is_soon = entry.deadline <= Date.current + 2.days && !entry.achieved?

            if is_overdue
              label_bg = '#cf222e'
              label_text = 'overdue'
            elsif is_soon
              label_bg = '#bf8700'
              label_text = 'priority'
            elsif entry.achieved?
              label_bg = '#8250df'
              label_text = 'completed'
            else
              label_bg = '#0969da'
              label_text = 'in progress'
            end
          %>
          <span style="font-size: 12px; font-weight: 500; padding: 0 7px; line-height: 18px; border-radius: 2em; background: <%= label_bg %>; color: white;">
            <%= label_text %>
          </span>
        <% end %>
      </div>

      <%# メタ情報 %>
      <div style="font-size: 12px; color: #656d76;">
        <span>opened <%= time_ago_in_words(entry.created_at) %> ago by</span>
        <span style="display: inline-flex; align-items: center; gap: 4px; margin-left: 4px;">
          <% if entry.display_avatar.present? %>
            <%= image_tag entry.display_avatar.url, style: "width: 14px; height: 14px; border-radius: 50%; object-fit: cover; vertical-align: middle;" %>
          <% end %>
          <span style="font-weight: 500; color: #24292f;"><%= entry.display_user_name %></span>
        </span>
        <% if entry.deadline.present? %>
          <span style="margin-left: 8px;">
            ・due <%= l(entry.deadline, format: :short) %>
          </span>
        <% end %>
      </div>
    </div>

    <%# 右側アクション %>
    <div class="opacity-0 group-hover:opacity-100 transition-opacity" style="display: flex; align-items: center; gap: 4px; flex-shrink: 0;">
      <% if user_signed_in? && entry.user == current_user %>
        <%= button_to post_post_entry_path(entry.post, entry),
              method: :delete,
              data: { turbo_confirm: "削除しますか？" },
              style: "padding: 8px; border-radius: 6px; background: none; border: 1px solid transparent; cursor: pointer; transition: all 0.15s;",
              title: "削除",
              onmouseover: "this.style.borderColor='#d0d7de'; this.style.backgroundColor='#f6f8fa';",
              onmouseout: "this.style.borderColor='transparent'; this.style.backgroundColor='transparent';" do %>
          <svg style="width: 16px; height: 16px; color: #656d76;" viewBox="0 0 16 16" fill="currentColor">
            <path d="M11 1.75V3h2.25a.75.75 0 0 1 0 1.5H2.75a.75.75 0 0 1 0-1.5H5V1.75C5 .784 5.784 0 6.75 0h2.5C10.216 0 11 .784 11 1.75ZM4.496 6.675l.66 6.6a.25.25 0 0 0 .249.225h5.19a.25.25 0 0 0 .249-.225l.66-6.6a.75.75 0 0 1 1.492.149l-.66 6.6A1.748 1.748 0 0 1 10.595 15h-5.19a1.75 1.75 0 0 1-1.741-1.575l-.66-6.6a.75.75 0 1 1 1.492-.15ZM6.5 1.75V3h3V1.75a.25.25 0 0 0-.25-.25h-2.5a.25.25 0 0 0-.25.25Z"></path>
          </svg>
        <% end %>
      <% end %>
    </div>
  </div>
</article>
<% end %>
