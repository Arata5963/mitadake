<%# app/views/posts/_section_user_ranking.html.erb %>
<%# ユーザー達成数ランキングセクション（全期間） %>

<section class="mb-8">
  <div class="mb-4">
    <h2 class="text-lg font-bold text-gray-900">達成数ランキング</h2>
  </div>

  <%# ランキングリスト %>
  <div id="user-ranking-list">
    <div class="space-y-2">
      <% if users.any? %>
        <% users.each_with_index do |user, index| %>
          <% rank = index + 1 %>
          <div class="flex items-center gap-3 bg-gray-50 rounded-lg p-3 [-webkit-tap-highlight-color:transparent]">
            <%# ランキング番号 %>
            <div class="flex-shrink-0 w-6 text-center">
              <span class="text-lg font-bold <%= rank <= 3 ? 'text-gray-900' : 'text-gray-400' %>">
                <%= rank %>
              </span>
            </div>

            <%# ユーザーアイコン %>
            <%= link_to user_profile_path(user), class: "flex-shrink-0 w-10 h-10 rounded-full overflow-hidden bg-gray-200 hover:opacity-80 transition-opacity [-webkit-tap-highlight-color:transparent]", data: { turbo_frame: "_top" } do %>
              <% if user.avatar.present? %>
                <%= image_tag user.avatar.url,
                      alt: user.name,
                      class: "w-full h-full object-cover",
                      loading: "lazy" %>
              <% else %>
                <div class="w-full h-full flex items-center justify-center bg-gray-300 text-gray-600 font-bold text-sm">
                  <%= user.name&.first&.upcase || '?' %>
                </div>
              <% end %>
            <% end %>

            <%# ユーザー情報 %>
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2">
                <%= link_to user_profile_path(user), class: "text-sm font-medium text-gray-900 truncate hover:underline [-webkit-tap-highlight-color:transparent]", data: { turbo_frame: "_top" } do %>
                  <%= user.name %>
                <% end %>
                <span class="text-xs font-medium text-gray-500"><%= user.achieved_count %>達成</span>
              </div>
              <% if user.favorite_quote.present? %>
                <% if user.favorite_quote_url.present? %>
                  <%= link_to user.favorite_quote_url, target: "_blank", rel: "noopener noreferrer", class: "block text-sm text-gray-600 line-clamp-2 mt-1 hover:text-gray-900 transition-colors [-webkit-tap-highlight-color:transparent]" do %>
                    「<%= user.favorite_quote %>」
                  <% end %>
                <% else %>
                  <p class="text-sm text-gray-600 line-clamp-2 mt-1">
                    「<%= user.favorite_quote %>」
                  </p>
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="text-center py-8 text-gray-500 text-sm">
          まだ達成者はいません
        </div>
      <% end %>
    </div>
  </div>
</section>
