<%# app/views/post_entries/_entry_card.html.erb %>
<%# 案15改: シンプルリッチ版 %>

<%= turbo_frame_tag dom_id(entry) do %>
<div style="display: flex; gap: 8px; padding: 10px 8px; align-items: flex-start;">

  <%# アバター（シンプル） %>
  <div style="flex-shrink: 0;">
    <% if entry.display_anonymous? %>
      <div style="width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(145deg, #a0aec0, #718096); display: flex; align-items: center; justify-content: center;">
        <svg style="width: 18px; height: 18px; color: white;" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
      </div>
    <% elsif entry.display_avatar.present? %>
      <%= image_tag entry.display_avatar.url, style: "width: 36px; height: 36px; border-radius: 10px; object-fit: cover;" %>
    <% else %>
      <div style="width: 36px; height: 36px; border-radius: 10px; background: #374151; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 14px;">
        <%= entry.display_user_name&.first&.upcase || '?' %>
      </div>
    <% end %>
  </div>

  <%# 吹き出し %>
  <div style="flex: 1; min-width: 0; position: relative;">
    <%# しっぽ（三角形 + グレー枠） %>
    <div style="position: absolute; left: -7px; top: 11px;">
      <%# グレー外枠 %>
      <div style="width: 0; height: 0; border-top: 7px solid transparent; border-bottom: 7px solid transparent; border-right: 7px solid #d1d5db;"></div>
    </div>
    <div style="position: absolute; left: -5px; top: 12px;">
      <%# 白の内側 %>
      <div style="width: 0; height: 0; border-top: 6px solid transparent; border-bottom: 6px solid transparent; border-right: 6px solid #fff;"></div>
    </div>

    <div style="background: #fff; border-radius: 14px; border-top-left-radius: 4px; padding: 10px 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border: 1px solid #d1d5db;">

      <%# ヘッダー: 名前 + 期限 + メニュー %>
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; gap: 6px;">
        <span style="font-weight: 600; font-size: 13px; color: #374151; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><%= entry.display_anonymous? ? '匿名' : entry.display_user_name %></span>

        <div style="display: flex; align-items: center; gap: 8px; flex-shrink: 0;">
          <%# 期限 %>
          <% if entry.deadline.present? %>
            <span style="display: flex; align-items: center; gap: 4px; font-size: 11px; color: #6b7280; background: #e5e7eb; padding: 2px 8px; border-radius: 10px;">
              <svg style="width: 12px; height: 12px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"/>
              </svg>
              <%= l(entry.deadline, format: :short) %>
            </span>
          <% end %>

          <%# 削除ボタン %>
          <% if user_signed_in? && entry.user == current_user %>
            <%= button_to post_post_entry_path(entry.post, entry), method: :delete, data: { turbo_confirm: "削除しますか？" }, style: "background: none; border: none; cursor: pointer; padding: 4px; opacity: 0.4; transition: opacity 0.15s;", onmouseover: "this.style.opacity='1'", onmouseout: "this.style.opacity='0.4'" do %>
              <svg style="width: 16px; height: 16px; color: #6b7280;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/>
              </svg>
            <% end %>
          <% end %>
        </div>
      </div>

      <%# 本文（左に丸チェックボックス） %>
      <div style="display: flex; align-items: flex-start; gap: 8px;">
        <% if user_signed_in? && entry.user == current_user %>
          <%= form_with url: achieve_post_post_entry_path(entry.post, entry), method: :patch, style: "flex-shrink: 0; margin-top: 1px;" do %>
            <button type="submit" style="width: 20px; height: 20px; border-radius: 50%; border: 2px solid <%= entry.achieved? ? '#1f2937' : '#d1d5db' %>; background: <%= entry.achieved? ? '#1f2937' : '#fff' %>; cursor: pointer; padding: 0; display: flex; align-items: center; justify-content: center; transition: transform 0.15s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
              <% if entry.achieved? %>
                <svg style="width: 12px; height: 12px; color: white;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12l5 5L20 7" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <% end %>
            </button>
          <% end %>
        <% end %>
        <p style="flex: 1; font-size: 14px; line-height: 1.5; color: #1f2937; margin: 0; word-break: break-word; <%= 'text-decoration: line-through; opacity: 0.6;' if entry.achieved? %>"><%= entry.content %></p>
      </div>
    </div>
  </div>
</div>
<% end %>
