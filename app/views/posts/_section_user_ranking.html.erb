<%#
  app/views/posts/_section_user_ranking.html.erb
  ==========================================
  アクティブユーザーランキングセクション
  ==========================================

  【このパーシャルの役割】
  アクションプラン達成数の多いユーザーをランキング表示。
  ユーザーをクリックするとそのユーザーのプロフィールページへ。

  【パラメータ】
  users: ランキング順のUserコレクション
         achieved_count 属性が必要

  【表示内容】
  - ランキング番号（大きな数字）
  - ユーザーアバター
  - ユーザー名
  - 達成アクション数

  【data: { turbo_frame: "_top" }】
  Turbo Frameの外側（トップレベル）でナビゲーション。
  プロフィールページへの遷移をスムーズにする。
%>

<%= render layout: "shared/horizontal_scroll_section", locals: {
  title: "アクティブユーザー",
  button_top: "40px",
  show_content: users.any?,
  empty_message: "まだ達成者はいません"
} do %>
  <% users.each_with_index do |user, index| %>
    <% rank = index + 1 %>
    <div class="flex-shrink-0 flex items-start gap-1" style="width: 100px; min-width: 100px;">
      <%# 大きなランキング番号 %>
      <div class="flex-shrink-0 w-6 flex items-center justify-center pt-6">
        <span class="text-2xl font-black text-gray-900"><%= rank %></span>
      </div>
      <%# ユーザーカード %>
      <%= link_to user_profile_path(user),
         class: "flex-1 flex flex-col items-center group [-webkit-tap-highlight-color:transparent]",
         data: { turbo_frame: "_top" } do %>
        <div class="mb-2">
          <%= render "shared/avatar", user: user, size: :xxl, fallback: :icon, lazy: true %>
        </div>
        <span class="text-xs text-gray-700 text-center max-w-[80px] truncate group-hover:text-gray-900 transition-colors">
          <%= user.name %>
        </span>
        <span class="text-[10px] text-gray-400">
          <%= user.achieved_count %>アクション
        </span>
      <% end %>
    </div>
  <% end %>
<% end %>
