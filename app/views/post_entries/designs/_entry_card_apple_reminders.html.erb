<%# app/views/post_entries/designs/_entry_card_apple_reminders.html.erb %>
<%# Apple Reminders風デザイン - iOS風、丸み、バッジ型残り日数表示 %>

<%
  # 残り日数に応じたスタイルを計算
  days = entry.days_remaining
  status = entry.deadline_status

  case status
  when :achieved
    badge_bg = '#f3f4f6'
    badge_text = '#6b7280'
    badge_label = '達成'
    text_style = 'text-decoration: line-through; color: #8e8e93;'
    checkbox_style = 'background: #000000;'
  when :expired
    badge_bg = '#f3f4f6'
    badge_text = '#6b7280'
    badge_label = '期限切れ'
    text_style = 'text-decoration: line-through; color: #9ca3af;'
    checkbox_style = 'border: 2px solid #c7c7cc;'
  when :today
    badge_bg = '#fef2f2'
    badge_text = '#dc2626'
    badge_label = '今日まで'
    text_style = 'color: #000;'
    checkbox_style = 'border: 2px solid #000000;'
  when :urgent
    badge_bg = '#fef2f2'
    badge_text = '#dc2626'
    badge_label = '残り1日'
    text_style = 'color: #000;'
    checkbox_style = 'border: 2px solid #000000;'
  when :warning
    badge_bg = '#fffbeb'
    badge_text = '#d97706'
    badge_label = "残り#{days}日"
    text_style = 'color: #000;'
    checkbox_style = 'border: 2px solid #000000;'
  else
    badge_bg = '#f0fdf4'
    badge_text = '#16a34a'
    badge_label = "残り#{days}日"
    text_style = 'color: #000;'
    checkbox_style = 'border: 2px solid #000000;'
  end
%>

<%= turbo_frame_tag dom_id(entry) do %>
<article class="group" style="position: relative; padding: 14px 16px; background: white; border-radius: 12px; margin-bottom: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.08);">
  <div style="display: flex; align-items: flex-start; gap: 14px;">

    <%# チェックボックス（iOS風の丸） %>
    <div style="flex-shrink: 0; padding-top: 2px;">
      <% if user_signed_in? && entry.user == current_user && !entry.achieved? %>
        <%# 自分の未達成 → クリックで達成に %>
        <%= button_to achieve_post_post_entry_path(entry.post, entry),
              method: :patch,
              class: "block",
              form: { data: { turbo_confirm: "「#{truncate(entry.content, length: 20)}」を達成しますか？", turbo_frame: "_top" } } do %>
          <div style="width: 22px; height: 22px; border-radius: 50%; <%= checkbox_style %> cursor: pointer; transition: all 0.2s ease;"
               onmouseover="this.style.backgroundColor='rgba(0,122,255,0.1)';"
               onmouseout="this.style.backgroundColor='transparent';"></div>
        <% end %>
      <% elsif entry.achieved? %>
        <%# 達成済み（クリック不可） %>
        <div style="width: 22px; height: 22px; border-radius: 50%; background: #000000; display: flex; align-items: center; justify-content: center;">
          <svg style="width: 12px; height: 12px; color: white;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
          </svg>
        </div>
      <% else %>
        <%# 他ユーザーの未達成（クリック不可） %>
        <div style="width: 22px; height: 22px; border-radius: 50%; <%= checkbox_style %>"></div>
      <% end %>
    </div>

    <%# コンテンツ %>
    <div style="flex: 1; min-width: 0;">
      <%# メインテキスト %>
      <p style="font-size: 17px; line-height: 1.4; margin: 0; font-weight: 400; -webkit-font-smoothing: antialiased; <%= text_style %>">
        <%= entry.content %>
      </p>

      <%# サブ情報（ユーザー + バッジ型残り日数 + 炎） %>
      <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 6px;">
        <%# 投稿者（左側） %>
        <div style="display: flex; align-items: center; gap: 6px;">
          <% if entry.display_avatar.present? %>
            <%= image_tag entry.display_avatar.url, style: "width: 16px; height: 16px; border-radius: 50%; object-fit: cover;" %>
          <% else %>
            <div style="width: 16px; height: 16px; border-radius: 50%; background: #e5e5ea; display: flex; align-items: center; justify-content: center;">
              <span style="font-size: 9px; font-weight: 600; color: #8e8e93;"><%= entry.display_user_name&.first&.upcase || '?' %></span>
            </div>
          <% end %>
          <span style="font-size: 13px; color: #8e8e93;"><%= entry.display_user_name %></span>
        </div>

        <%# 期限 + 炎（右側） %>
        <div style="display: flex; align-items: center; gap: 10px;">
          <%# 残り日数バッジ（未達成のみ表示） %>
          <% unless entry.achieved? %>
            <span style="display: inline-flex; align-items: center; padding: 2px 10px; background: <%= badge_bg %>; border-radius: 10px; font-size: 12px; font-weight: 500; color: <%= badge_text %>;">
              <%= badge_label %>
            </span>
          <% end %>

          <%# 炎ボタン %>
          <%= render "entry_flames/flame_button", post_entry: entry %>
        </div>
      </div>
    </div>

  </div>

  <%# ゴミ箱ボタン（右上・自分のエントリのみ） %>
  <% if user_signed_in? && entry.user == current_user %>
    <div style="position: absolute; top: 14px; right: 16px;">
      <%= button_to post_post_entry_path(entry.post, entry),
            method: :delete,
            form: { data: { turbo_confirm: "削除しますか？", turbo_frame: "_top" } },
            style: "display: flex; align-items: center; justify-content: center; padding: 0; background: transparent; border: none; cursor: pointer;",
            title: "削除" do %>
        <svg style="width: 16px; height: 16px; color: #c7c7cc;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        </svg>
      <% end %>
    </div>
  <% end %>
</article>
<% end %>
