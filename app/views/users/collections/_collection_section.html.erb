<%#
  app/views/users/collections/_collection_section.html.erb
  ==========================================
  ÈÅîÊàê„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„Çª„ÇØ„Ç∑„Éß„É≥
  ==========================================

  „Äê„Åì„ÅÆ„Éë„Éº„Ç∑„É£„É´„ÅÆÂΩπÂâ≤„Äë
  „Éû„Ç§„Éö„Éº„Ç∏„ÅßÈÅîÊàê„Åó„Åü„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥„ÇíË°®Á§∫„Åô„Çã„Çª„ÇØ„Ç∑„Éß„É≥„ÄÇ
  Ë§áÊï∞„ÅÆ„Éá„Ç∂„Ç§„É≥„ÉÜ„Éº„Éû„Åã„ÇâÈÅ∏ÊäûÂèØËÉΩ„ÄÇ

  „Äê„Éë„É©„É°„Éº„Çø„Äë
  - achieved_entries: ÈÅîÊàêÊ∏à„ÅøPostEntry„ÅÆ„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥
  - user: User„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
  - is_own_page: Ëá™ÂàÜ„ÅÆ„Éö„Éº„Ç∏„Åã„Å©„ÅÜ„Åã

  „ÄêÂà©Áî®ÂèØËÉΩ„Å™„Éá„Ç∂„Ç§„É≥„Äë
  1. youtube: YouTubeÂãïÁîªÈ¢®
  2. quote_card: ÂêçË®Ä„Ç´„Éº„ÉâÈ¢®
  3. journal: Êó•Ë®ò/„Ç∏„É£„Éº„Éä„É´È¢®
  4. certificate: ÈÅîÊàêË®ºÊòéÊõ∏È¢®
  5. sticky: ‰ªòÁÆã„É°„É¢È¢®
  6. recipe: „É¨„Ç∑„Éî„Ç´„Éº„ÉâÈ¢®

  „Äê„Éá„Ç∂„Ç§„É≥Âàá„ÇäÊõø„Åà„Äë
  URL„Éë„É©„É°„Éº„Çø ?design=xxx „ÅßÂàá„ÇäÊõø„Åà„ÄÇ
  „Éá„Éï„Ç©„É´„Éà„ÅØ 'youtube'„ÄÇ

  „Äê„Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥„Äë
  „Éá„Ç∂„Ç§„É≥„Åî„Å®„Å´1„Éö„Éº„Ç∏„ÅÇ„Åü„Çä„ÅÆË°®Á§∫Êï∞„ÅåÁï∞„Å™„Çã„ÄÇ
  Kaminari„Å®Âêå„ÅòUI„ÅßËá™ÂâçÂÆüË£Ö„ÄÇ
%>
<%
  designs = [
    { key: 'youtube', name: 'YouTubeÈ¢®', icon: '‚ñ∂Ô∏è', description: 'Ëá™ÂàÜ„ÅÆÂãïÁîª„Å®„Åó„Å¶Ë°®Á§∫' },
    { key: 'quote_card', name: 'ÂêçË®Ä„Ç´„Éº„Éâ', icon: 'üí¨', description: 'ÂãïÁîª„ÇíËÉåÊôØ„Å´„ÄÅÂ≠¶„Å≥„ÅåÊµÆ„Åã„Å∂' },
    { key: 'journal', name: '„Ç∏„É£„Éº„Éä„É´', icon: 'üìî', description: '„Éé„Éº„Éà„Å´Ë®òÈå≤„Åó„ÅüÊÄù„ÅÑÂá∫' },
    { key: 'certificate', name: 'Ë®ºÊòéÊõ∏', icon: 'üìú', description: 'ÈÅîÊàê„ÅÆÂÖ¨Âºè„Å™Ë®º' },
    { key: 'sticky', name: '‰ªòÁÆã„É°„É¢', icon: 'üìù', description: 'ÂãïÁîª„Å´Ë≤º„Å£„ÅüÂ≠¶„Å≥„ÅÆ„É°„É¢' },
    { key: 'recipe', name: '„É¨„Ç∑„Éî', icon: 'üç≥', description: 'Ë°åÂãï„ÅÆ„É¨„Ç∑„Éî„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥' },
  ]
  current_design = params[:design].presence || 'youtube'
  current_design = 'youtube' unless designs.map { |d| d[:key] }.include?(current_design)
  current_design_info = designs.find { |d| d[:key] == current_design }
%>

<section class="mt-8" data-controller="collection-design">
  <%# „Çª„ÇØ„Ç∑„Éß„É≥„Éò„ÉÉ„ÉÄ„Éº %>
  <div class="flex items-center gap-2 mb-4">
    <h2 class="text-lg font-bold text-gray-900">ÈÅîÊàê„Åó„Åü„Ç¢„ÇØ„Ç∑„Éß„É≥</h2>
  </div>

  <%# „Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„Ç∞„É™„ÉÉ„ÉâÔºà„Éá„Ç∂„Ç§„É≥„Å´„Çà„Å£„Å¶„É¨„Ç§„Ç¢„Ç¶„Éà„ÅåÂ§â„Çè„ÇãÔºâ %>
  <%
    case current_design
    when 'youtube'
      grid_class = 'collection-grid-youtube'
      per_page = 9  # PC: 3√ó3, „Çπ„Éû„Éõ: 1√ó6
    when 'quote_card'
      grid_class = 'grid grid-cols-2 sm:grid-cols-3 gap-4'
      per_page = 6
    when 'journal'
      grid_class = 'grid grid-cols-1 sm:grid-cols-2 gap-4'
      per_page = 4
    when 'certificate'
      grid_class = 'grid grid-cols-1 sm:grid-cols-2 gap-4'
      per_page = 4
    when 'sticky'
      grid_class = 'grid grid-cols-2 sm:grid-cols-3 gap-3'
      per_page = 6
    when 'recipe'
      grid_class = 'grid grid-cols-1 sm:grid-cols-2 gap-4'
      per_page = 4
    else
      grid_class = 'grid grid-cols-1 sm:grid-cols-2 gap-4'
      per_page = 6
    end

    # „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥
    current_page = (params[:page] || 1).to_i
    total_count = achieved_entries.size
    total_pages = (total_count.to_f / per_page).ceil
    current_page = [[current_page, 1].max, total_pages].min
    current_page = 1 if total_pages == 0

    paginated_entries = achieved_entries.offset((current_page - 1) * per_page).limit(per_page)
  %>

  <%# „Ç∞„É™„ÉÉ„ÉâË°®Á§∫ %>
  <div class="<%= grid_class %>">
    <% paginated_entries.each do |entry| %>
      <%= render "users/collections/#{current_design}", entry: entry %>
    <% end %>
  </div>

  <%# „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ÔºàKaminari„Å®Âêå„Åò„Éá„Ç∂„Ç§„É≥Ôºâ %>
  <% if total_pages > 1 %>
    <nav class="mt-6 flex justify-center items-center gap-2" aria-label="„Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥">
      <%# Ââç„Å∏„Éú„Çø„É≥ %>
      <% if current_page > 1 %>
        <%= link_to url_for(page: current_page - 1, design: current_design),
              class: "h-10 px-4 flex items-center justify-center border border-gray-200 bg-white hover:bg-gray-50 text-gray-700 text-sm font-medium rounded-lg transition-colors" do %>
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          Ââç„Å∏
        <% end %>
      <% end %>

      <%# „Éö„Éº„Ç∏Áï™Âè∑ %>
      <%
        # Ë°®Á§∫„Åô„Çã„Éö„Éº„Ç∏Áï™Âè∑„ÅÆÁØÑÂõ≤„ÇíË®àÁÆó
        if total_pages <= 5
          page_range = (1..total_pages)
        elsif current_page <= 3
          page_range = (1..[5, total_pages].min)
        elsif current_page >= total_pages - 2
          page_range = ([total_pages - 4, 1].max..total_pages)
        else
          page_range = ((current_page - 2)..(current_page + 2))
        end
      %>

      <% page_range.each do |page_num| %>
        <% if page_num == current_page %>
          <span class="w-10 h-10 flex items-center justify-center bg-gray-900 text-white text-sm font-medium rounded-lg">
            <%= page_num %>
          </span>
        <% else %>
          <%= link_to page_num, url_for(page: page_num, design: current_design),
                class: "w-10 h-10 flex items-center justify-center border border-gray-200 bg-white hover:bg-gray-50 text-gray-700 text-sm font-medium rounded-lg transition-colors" %>
        <% end %>
      <% end %>

      <%# Ê¨°„Å∏„Éú„Çø„É≥ %>
      <% if current_page < total_pages %>
        <%= link_to url_for(page: current_page + 1, design: current_design),
              class: "h-10 px-4 flex items-center justify-center border border-gray-200 bg-white hover:bg-gray-50 text-gray-700 text-sm font-medium rounded-lg transition-colors" do %>
          Ê¨°„Å∏
          <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        <% end %>
      <% end %>
    </nav>
  <% end %>
</section>
