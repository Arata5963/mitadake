<%# app/views/post_entries/_thread_list.html.erb %>
<%# сѓ╣сЃгсЃЃсЃЅтйбт╝ЈсЂ«сѓбсѓ»сѓисЃДсЃ│сЃЌсЃЕсЃ│СИђУдД - сЃдсЃ╝сѓХсЃ╝сЂћсЂесЂФсѓ░сЃФсЃ╝сЃЌтїќ %>

<%
  entries = post.post_entries.recent.includes(:user)

  # УЄфтѕєсЂ«ТіЋуе┐сЂесЂЮсЂ«С╗ќсѓњтѕєжЏб
  if user_signed_in?
    my_entries = entries.select { |e| e.user_id == current_user.id }
    other_entries = entries.reject { |e| e.user_id == current_user.id }
  else
    my_entries = []
    other_entries = entries.to_a
  end

  # сЂЮсЂ«С╗ќсЂ«ТіЋуе┐сѓњсЃдсЃ╝сѓХсЃ╝сЂћсЂесЂФсѓ░сЃФсЃ╝сЃЌтїќ№╝ѕТіЋуе┐жаєсѓњуХГТїЂ№╝Ѕ
  other_grouped = other_entries.group_by(&:user_id)
  # сЃдсЃ╝сѓХсЃ╝сЂ«ТюђтѕЮсЂ«ТіЋуе┐жаєсЂДсѓйсЃ╝сЃѕ
  other_user_order = other_entries.map(&:user_id).uniq
%>

<%# ===== УЄфтѕєсЂ«сѓбсѓ»сѓисЃДсЃ│сЃЌсЃЕсЃ│ ===== %>
<% if my_entries.present? %>
  <div class="mb-4">
    <div class="text-xs font-medium text-gray-500 mb-2 px-1">сЂѓсЂфсЂЪсЂ«сѓбсѓ»сѓисЃДсЃ│сЃЌсЃЕсЃ│</div>
    <div class="bg-[#f2f2f7] rounded-xl overflow-hidden" style="padding: 8px;">
      <%= render partial: 'post_entries/thread_group', locals: {
        entries: my_entries,
        user: current_user,
        is_own: true
      } %>
    </div>
  </div>
<% end %>

<%# ===== сЂ┐сѓЊсЂфсЂ«сѓбсѓ»сѓисЃДсЃ│сЃЌсЃЕсЃ│ ===== %>
<% if other_grouped.present? %>
  <div>
    <div class="text-xs font-medium text-gray-500 mb-2 px-1">сЂ┐сѓЊсЂфсЂ«сѓбсѓ»сѓисЃДсЃ│сЃЌсЃЕсЃ│</div>
    <div class="bg-[#f2f2f7] rounded-xl overflow-hidden" style="padding: 8px;">
      <% other_user_order.each_with_index do |user_id, index| %>
        <% user_entries = other_grouped[user_id] %>
        <% entry_user = user_entries.first.user %>
        <%= render partial: 'post_entries/thread_group', locals: {
          entries: user_entries,
          user: entry_user,
          is_own: false
        } %>
        <% if index < other_user_order.length - 1 %>
          <div style="height: 8px;"></div>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>

<%# ===== ТіЋуе┐сЂїсЂфсЂёта┤тљѕ ===== %>
<% if my_entries.empty? && other_grouped.empty? %>
  <div class="text-center py-8 px-4 bg-gray-50 rounded-xl">
    <div class="text-4xl mb-3 opacity-50">­ЪњГ</div>
    <p class="text-sm text-gray-500">сЂЙсЂасѓбсѓ»сѓисЃДсЃ│сЃЌсЃЕсЃ│сЂїсЂѓсѓісЂЙсЂЏсѓЊ</p>
    <p class="text-xs text-gray-400 mt-1">ТюђтѕЮсЂ«сѓбсѓ»сѓисЃДсЃ│сЃЌсЃЕсЃ│сѓњТіЋуе┐сЂЌсЂдсЂ┐сЂЙсЂЌсѓЄсЂє№╝Ђ</p>
  </div>
<% end %>
