<%# app/views/post_entries/designs/_entry_card_slack.html.erb %>
<%# SlackÈ¢®„Éá„Ç∂„Ç§„É≥ - „É°„ÉÉ„Çª„Éº„Ç∏„Çπ„Çø„Ç§„É´„ÄÅ„Éõ„Éê„Éº„Åß„É™„Ç¢„ÇØ„Ç∑„Éß„É≥Ë°®Á§∫ %>

<%= turbo_frame_tag dom_id(entry) do %>
<article class="group" style="padding: 8px 20px; transition: background-color 0.1s;"
         onmouseover="this.style.backgroundColor='#f8f8f8';"
         onmouseout="this.style.backgroundColor='transparent';">
  <div style="display: flex; gap: 12px;">

    <%# „Ç¢„Éê„Çø„Éº %>
    <div style="flex-shrink: 0;">
      <% if entry.display_avatar.present? %>
        <%= image_tag entry.display_avatar.url, style: "width: 36px; height: 36px; border-radius: 4px; object-fit: cover;" %>
      <% else %>
        <%# Slack„Å£„ÅΩ„ÅÑ„Ç´„É©„Éï„É´„Å™„Éá„Éï„Ç©„É´„Éà„Ç¢„Éê„Çø„Éº %>
        <% colors = ['#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#009688', '#4caf50', '#ff9800'] %>
        <% avatar_color = colors[entry.display_user_name.to_s.bytes.sum % colors.length] %>
        <div style="width: 36px; height: 36px; border-radius: 4px; background: <%= avatar_color %>; display: flex; align-items: center; justify-content: center;">
          <span style="font-size: 16px; font-weight: 700; color: white;"><%= entry.display_user_name&.first&.upcase || '?' %></span>
        </div>
      <% end %>
    </div>

    <%# „Ç≥„É≥„ÉÜ„É≥„ÉÑ %>
    <div style="flex: 1; min-width: 0;">
      <%# „Éò„ÉÉ„ÉÄ„Éº: ÂêçÂâç + ÊôÇÂàª %>
      <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 4px;">
        <span style="font-size: 15px; font-weight: 700; color: #1d1c1d;"><%= entry.display_user_name %></span>
        <span style="font-size: 12px; color: #616061;"><%= entry.created_at.strftime("%-H:%M") %></span>
        <% if entry.achieved? %>
          <span style="font-size: 11px; padding: 1px 6px; background: #007a5a; color: white; border-radius: 3px; font-weight: 500;">ÂÆå‰∫Ü</span>
        <% end %>
      </div>

      <%# „É°„ÉÉ„Çª„Éº„Ç∏Êú¨Êñá %>
      <div style="font-size: 15px; line-height: 1.46; color: <%= entry.achieved? ? '#616061' : '#1d1c1d' %>; <%= 'text-decoration: line-through;' if entry.achieved? %>">
        <%= entry.content %>
      </div>

      <%# ÊúüÈôêÔºà„É™„Éû„Ç§„É≥„ÉÄ„ÉºÈ¢®Ôºâ %>
      <% if entry.deadline.present? %>
        <% is_overdue = entry.deadline < Date.current && !entry.achieved? %>
        <div style="display: inline-flex; align-items: center; gap: 6px; margin-top: 8px; padding: 4px 8px; background: <%= is_overdue ? '#fdf4f4' : '#f0f4f8' %>; border-radius: 4px; border: 1px solid <%= is_overdue ? '#e8c5c5' : '#d3dce6' %>;">
          <svg style="width: 14px; height: 14px; color: <%= is_overdue ? '#e01e5a' : '#1264a3' %>;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <span style="font-size: 13px; color: <%= is_overdue ? '#e01e5a' : '#1264a3' %>; font-weight: 500;">
            <%= is_overdue ? 'ÊúüÈôêÂàá„Çå: ' : 'ÊúüÈôê: ' %><%= l(entry.deadline, format: :short) %>
          </span>
        </div>
      <% end %>

      <%# „É™„Ç¢„ÇØ„Ç∑„Éß„É≥„Éê„ÉºÔºà„Éõ„Éê„ÉºÊôÇË°®Á§∫Ôºâ %>
      <div class="opacity-0 group-hover:opacity-100 transition-opacity" style="position: absolute; right: 20px; top: 4px; display: flex; gap: 2px; background: white; border: 1px solid #e8e8e8; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.08);">
        <% if user_signed_in? && entry.user == current_user && !entry.achieved? %>
          <%= button_to achieve_post_post_entry_path(entry.post, entry),
                method: :patch,
                style: "padding: 6px 8px; background: none; border: none; cursor: pointer; border-radius: 4px; transition: background-color 0.1s;",
                title: "ÂÆå‰∫Ü„Å´„Åô„Çã",
                form: { data: { turbo_confirm: "„Äå#{truncate(entry.content, length: 20)}„Äç„ÇíÈÅîÊàê„Åó„Åæ„Åô„ÅãÔºü" } },
                onmouseover: "this.style.backgroundColor='#f0f4f8'",
                onmouseout: "this.style.backgroundColor='transparent'" do %>
            <span style="font-size: 16px;">‚úÖ</span>
          <% end %>
        <% end %>

        <%= link_to post_path(entry.post), style: "padding: 6px 8px; text-decoration: none; border-radius: 4px; transition: background-color 0.1s; display: flex; align-items: center;", data: { turbo_frame: "_top" }, title: "ÂãïÁîª„ÇíË¶ã„Çã",
              onmouseover: "this.style.backgroundColor='#f0f4f8'",
              onmouseout: "this.style.backgroundColor='transparent'" do %>
          <span style="font-size: 16px;">üé¨</span>
        <% end %>

        <% if user_signed_in? && entry.user == current_user %>
          <%= button_to post_post_entry_path(entry.post, entry),
                method: :delete,
                data: { turbo_confirm: "ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" },
                style: "padding: 6px 8px; background: none; border: none; cursor: pointer; border-radius: 4px; transition: background-color 0.1s;",
                title: "ÂâäÈô§",
                onmouseover: "this.style.backgroundColor='#fdf4f4'",
                onmouseout: "this.style.backgroundColor='transparent'" do %>
            <span style="font-size: 16px;">üóëÔ∏è</span>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</article>
<% end %>
