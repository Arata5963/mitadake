<%#
  app/views/posts/index.turbo_stream.erb
  ==========================================
  Turbo Stream: 無限スクロール用レスポンス
  ==========================================

  【このファイルの役割】
  無限スクロールで次のページを読み込む時のレスポンス。
  投稿一覧ページをスクロールすると自動的に呼ばれる。

  【リクエスト形式】
  GET /posts?page=2&format=turbo_stream

  【処理内容】
  1. 新しい投稿を posts-grid に追加
  2. 次ページがなければローダーを削除

  【show_option について】
  @current_type に応じて表示するエントリータイプを決定。
  - "memo" → メモを表示
  - "quote" → 引用を表示
  - "action" → アクションプランを表示

  【turbo_stream.remove】
  次のページがない場合、ローディングインジケーターを
  削除して無限スクロールを終了させる。
%>

<% show_option = case @current_type
                 when "memo" then { show_memo: true }
                 when "quote" then { show_quote: true }
                 when "action" then { show_action: true }
                 when "blog" then { show_blog: true }
                 else {}
                 end %>

<% if @posts.present? %>
  <%# 新しい投稿を追加 %>
  <% @posts.each do |post| %>
    <%= turbo_stream.append "posts-grid" do %>
      <%= render 'posts/post_card_note', post: post, **show_option %>
    <% end %>
  <% end %>
<% end %>

<%# 次ページがない場合はローダーを非表示にする %>
<% unless @posts.respond_to?(:next_page) && @posts.next_page %>
  <%= turbo_stream.remove "infinite-scroll-loader" %>
<% end %>
