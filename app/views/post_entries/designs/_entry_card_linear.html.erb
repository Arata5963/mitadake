<%# app/views/post_entries/designs/_entry_card_linear.html.erb %>
<%# Linear風デザイン - ダークモード、プロフェッショナル、紫アクセント %>

<%= turbo_frame_tag dom_id(entry) do %>
<article class="group" style="padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.06); transition: background-color 0.1s ease;"
         onmouseover="this.style.backgroundColor='rgba(255,255,255,0.03)';"
         onmouseout="this.style.backgroundColor='transparent';">
  <div style="display: flex; align-items: flex-start; gap: 12px;">

    <%# ステータスアイコン（丸いチェックボックス） %>
    <div style="flex-shrink: 0; padding-top: 2px;">
      <% if user_signed_in? && entry.user == current_user && !entry.achieved? %>
        <%= button_to achieve_post_post_entry_path(entry.post, entry),
              method: :patch,
              class: "block",
              form: { data: { turbo_confirm: "「#{truncate(entry.content, length: 20)}」を達成しますか？" } } do %>
          <div style="width: 18px; height: 18px; border-radius: 50%; border: 2px solid #5e6ad2; cursor: pointer; transition: all 0.15s ease; position: relative;"
               onmouseover="this.style.backgroundColor='rgba(94,106,210,0.2)';"
               onmouseout="this.style.backgroundColor='transparent';"></div>
        <% end %>
      <% elsif entry.achieved? %>
        <div style="width: 18px; height: 18px; border-radius: 50%; background: linear-gradient(135deg, #5e6ad2, #8b5cf6); display: flex; align-items: center; justify-content: center;">
          <svg style="width: 10px; height: 10px; color: white;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
          </svg>
        </div>
      <% else %>
        <div style="width: 18px; height: 18px; border-radius: 50%; border: 2px solid #4a4b5c;"></div>
      <% end %>
    </div>

    <%# メインコンテンツ %>
    <div style="flex: 1; min-width: 0;">
      <%# タイトル行 %>
      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
        <p style="font-size: 14px; font-weight: 500; color: <%= entry.achieved? ? '#6b6f76' : '#f2f2f2' %>; margin: 0; line-height: 1.4; <%= 'text-decoration: line-through;' if entry.achieved? %>">
          <%= entry.content %>
        </p>
      </div>

      <%# メタ情報バー %>
      <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
        <%# ユーザー %>
        <div style="display: flex; align-items: center; gap: 6px;">
          <% if entry.display_avatar.present? %>
            <%= image_tag entry.display_avatar.url, style: "width: 16px; height: 16px; border-radius: 50%; object-fit: cover; border: 1px solid rgba(255,255,255,0.1);" %>
          <% else %>
            <div style="width: 16px; height: 16px; border-radius: 50%; background: linear-gradient(135deg, #5e6ad2, #8b5cf6); display: flex; align-items: center; justify-content: center;">
              <span style="font-size: 8px; font-weight: 600; color: white;"><%= entry.display_user_name&.first&.upcase || '?' %></span>
            </div>
          <% end %>
          <span style="font-size: 12px; color: #6b6f76;"><%= entry.display_user_name %></span>
        </div>

        <%# 期限バッジ %>
        <% if entry.deadline.present? %>
          <% is_overdue = entry.deadline < Date.current && !entry.achieved? %>
          <% is_today = entry.deadline == Date.current %>
          <span style="font-size: 11px; padding: 2px 8px; border-radius: 4px; display: flex; align-items: center; gap: 4px;
                       <%= if is_overdue
                             'background: rgba(239,68,68,0.15); color: #f87171;'
                           elsif is_today
                             'background: rgba(251,191,36,0.15); color: #fbbf24;'
                           else
                             'background: rgba(255,255,255,0.06); color: #6b6f76;'
                           end %>">
            <svg style="width: 10px; height: 10px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <%= l(entry.deadline, format: :short) %>
          </span>
        <% end %>

        <%# 作成日 %>
        <span style="font-size: 11px; color: #4a4b5c;"><%= time_ago_in_words(entry.created_at) %>前</span>
      </div>
    </div>

    <%# 右側アクション %>
    <div class="opacity-0 group-hover:opacity-100 transition-opacity" style="display: flex; align-items: center; gap: 4px; flex-shrink: 0;">
      <%= link_to post_path(entry.post), style: "padding: 6px; border-radius: 4px; transition: background-color 0.1s;", data: { turbo_frame: "_top" }, title: "動画を見る",
            onmouseover: "this.style.backgroundColor='rgba(255,255,255,0.06)'",
            onmouseout: "this.style.backgroundColor='transparent'" do %>
        <svg style="width: 14px; height: 14px; color: #6b6f76;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
        </svg>
      <% end %>

      <% if user_signed_in? && entry.user == current_user %>
        <%= button_to post_post_entry_path(entry.post, entry),
              method: :delete,
              data: { turbo_confirm: "削除しますか？" },
              style: "padding: 6px; border-radius: 4px; background: none; border: none; cursor: pointer; transition: background-color 0.1s;",
              title: "削除",
              onmouseover: "this.style.backgroundColor='rgba(239,68,68,0.1)'",
              onmouseout: "this.style.backgroundColor='transparent'" do %>
          <svg style="width: 14px; height: 14px; color: #6b6f76;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
          </svg>
        <% end %>
      <% end %>
    </div>
  </div>
</article>
<% end %>
