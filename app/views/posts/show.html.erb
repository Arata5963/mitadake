<%# 動画詳細ページ %>
<%# YouTube動画の詳細情報とアクションプラン一覧を表示 %>
<% content_for :title, @post.youtube_title&.truncate(30) || "動画詳細" %>

<div class="min-h-screen bg-white">
  <%# メインコンテンツエリア %>
  <div class="max-w-5xl mx-auto px-5 pt-6">

    <%# ヒーロー: YouTubeサムネイル %>
    <%= link_to @post.youtube_url,
          target: "_blank",
          rel: "noopener noreferrer",
          class: "block relative group mb-8" do %>
      <div class="aspect-video w-full rounded-lg overflow-hidden bg-gray-100">
        <%= image_tag @post.youtube_thumbnail_url(size: :hqdefault),
              alt: @post.youtube_title,
              class: "w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",
              loading: "lazy",
              onerror: "this.src='#{@post.youtube_thumbnail_url(size: :mqdefault)}'" %>
      </div>
      <%# 再生ボタン %>
      <div class="absolute inset-0 flex items-center justify-center">
        <div class="w-14 h-14 bg-black/60 rounded-full flex items-center justify-center group-hover:bg-gray-700 group-hover:scale-110 transition-all duration-300">
          <svg class="w-6 h-6 text-white ml-0.5" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </div>
      </div>
      <%# YouTubeラベル %>
      <div class="absolute top-3 left-3 flex items-center gap-1.5 bg-black/60 text-white text-xs px-2 py-1 rounded">
        <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
        </svg>
        <span>YouTubeで見る</span>
      </div>
    <% end %>

    <%# タイトル %>
    <h1 class="text-xl font-bold text-gray-900 leading-snug mb-3">
      <%= @post.youtube_title %>
    </h1>

    <%# チャンネル名 %>
    <% if @post.youtube_channel_name.present? %>
      <div class="flex items-center gap-2 mb-4">
        <% if @post.youtube_channel_thumbnail_url.present? %>
          <%= image_tag @post.youtube_channel_thumbnail_url,
                class: "w-6 h-6 rounded-full object-cover",
                alt: @post.youtube_channel_name,
                loading: "lazy" %>
        <% else %>
          <div class="w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center">
            <svg class="w-3.5 h-3.5 text-gray-400" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
          </div>
        <% end %>
        <p class="text-sm text-gray-500">
          <%= @post.youtube_channel_name %>
        </p>
      </div>
    <% end %>

    <%# ユーザー数 & ランキング %>
    <div class="flex items-center gap-2 mb-5">
      <span class="text-xs text-gray-400"><%= @post.post_entries.achieved.count %>人がアクションプランを達成</span>
      <% if (rank = @post.action_count_rank) %>
        <span class="inline-flex items-center px-2 py-0.5 bg-gray-100 rounded-full text-xs font-semibold text-gray-700">
          TOP <%= rank %>
        </span>
      <% end %>
    </div>

    <div class="h-6"></div>
  </div>

  <%# 達成したアクションセクション %>
  <section class="border-t border-gray-100 pt-8 mb-8">
    <div class="max-w-5xl mx-auto px-5">
      <% achieved_entries = @post.post_entries.achieved.includes(:user).order(achieved_at: :desc) %>

      <h2 class="text-base font-bold text-gray-900 mb-6">達成したアクション</h2>

      <% if achieved_entries.any? %>
        <div class="action-plan-grid">
          <% achieved_entries.each do |entry| %>
            <%= render 'shared/entry_card', entry: entry, post: @post %>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8 px-4 bg-gray-50 rounded-xl">
          <p class="text-sm text-gray-500">まだ達成されたアクションがありません</p>
        </div>
      <% end %>
    </div>
  </section>
</div>
