<%# app/views/users/designs/_action_plan_card.html.erb %>
<%# アクションプランカード（共通パーシャル） %>

<article style="max-width: 320px; position: relative;"
         data-controller="achievement-card"
         data-achievement-card-entry-id-value="<%= current_action.id %>"
         data-achievement-card-post-id-value="<%= current_video.id %>"
         data-achievement-card-achieve-url-value="<%= achieve_post_post_entry_path(current_video, current_action) %>"
         data-achievement-card-mode-value="input"
         data-achievement-card-video-thumbnail-value="<%= current_video.youtube_thumbnail_url %>"
         data-achievement-card-video-url-value="<%= post_path(current_video) %>"
         data-achievement-card-video-title-value="<%= current_video.youtube_title %>">
  <% if is_own_page %>
    <%# 3点リーダーメニュー（右上） %>
    <details style="position: absolute; top: 8px; right: 8px; z-index: 10;">
      <summary style="width: 28px; height: 28px; border-radius: 50%; background: rgba(255,255,255,0.9); display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 3px rgba(0,0,0,0.2); cursor: pointer; list-style: none;">
        <svg style="width: 16px; height: 16px; color: #666;" fill="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="5" r="2"/>
          <circle cx="12" cy="12" r="2"/>
          <circle cx="12" cy="19" r="2"/>
        </svg>
      </summary>
      <div style="position: absolute; top: 32px; right: 0; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 120px; overflow: hidden;">
        <%= link_to edit_post_post_entry_path(current_video, current_action, from: 'mypage'),
              style: "display: flex; align-items: center; gap: 8px; padding: 10px 14px; color: #333; font-size: 14px; text-decoration: none; transition: background 0.15s;",
              onmouseover: "this.style.background='#f5f5f5'",
              onmouseout: "this.style.background='white'" do %>
          <svg style="width: 14px; height: 14px; color: #666;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
          </svg>
          編集
        <% end %>
        <%= link_to post_post_entry_path(current_video, current_action),
              method: :delete,
              data: { turbo_method: :delete, turbo_confirm: "このアクションプランを削除しますか？" },
              style: "display: flex; align-items: center; gap: 8px; padding: 10px 14px; color: #dc2626; font-size: 14px; text-decoration: none; transition: background 0.15s;",
              onmouseover: "this.style.background='#fef2f2'",
              onmouseout: "this.style.background='white'" do %>
          <svg style="width: 14px; height: 14px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
          </svg>
          削除
        <% end %>
      </div>
    </details>
  <% end %>
  <div style="position: relative; background: #f3f4f6; aspect-ratio: 16/9; border-radius: 8px; overflow: hidden; cursor: pointer;"
       data-action="click->achievement-card#open">
    <%= image_tag display_thumbnail,
          alt: current_action.content,
          style: "width: 100%; height: 100%; object-fit: cover;",
          loading: "lazy" %>
  </div>
  <div style="padding-top: 8px;">
    <p style="font-size: 14px; font-weight: 500; color: #333; margin: 0; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
      <%= current_action.content %>
    </p>
    <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 8px;">
      <div style="display: flex; align-items: center; gap: 6px;">
        <% if user.avatar.present? && user.avatar.url.present? %>
          <%= image_tag user.avatar.url, style: "width: 24px; height: 24px; border-radius: 50%; object-fit: cover;" %>
        <% else %>
          <div style="width: 24px; height: 24px; border-radius: 50%; background: #e5e7eb; display: flex; align-items: center; justify-content: center;">
            <svg style="width: 14px; height: 14px; color: #9ca3af;" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
          </div>
        <% end %>
        <span style="font-size: 12px; color: #888;"><%= user.name.presence || "名無しさん" %></span>
      </div>
<%# ハートいいねボタン（turbo_stream対応パーシャル使用） %>
      <%= render 'post_entries/like_button', post_entry: current_action %>
    </div>
  </div>
</article>
