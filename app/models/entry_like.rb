# app/models/entry_like.rb
# ==========================================
# いいね（アクションプランへの応援）
# ==========================================
#
# 【このモデルの役割】
# ユーザーがアクションプランに「いいね」したことを記録する。
# 中間テーブル（2つのモデルを繋ぐテーブル）として機能する。
#
# 【データベースのカラム】
# - user_id: いいねしたユーザーのID
# - post_entry_id: いいねされたアクションプランのID
# - created_at: いいねした日時
#
# 【他のモデルとの関係】
#
#   User（いいねした人）
#     │
#     │ has_many :entry_likes
#     ↓
#   EntryLike（この中間テーブル）
#     │
#     │ belongs_to :post_entry
#     ↓
#   PostEntry（いいねされたアクションプラン）
#
# 【図解】
#
#   Aさん ───┐
#            │いいね
#   Bさん ───┼────→ アクションプラン1
#            │
#   Cさん ───┘
#
#   この「いいね」の関係を保存しているのがEntryLike。
#   例: Aさんがアクションプラン1にいいね → EntryLike(user_id=A, post_entry_id=1)
#
# 【中間テーブルとは？】
# 多対多の関係（複数のユーザーが複数のアクションプランにいいねできる）を
# 表現するためのテーブル。
# UserとPostEntryを直接繋ぐのではなく、間にEntryLikeを挟む。
#
# 【なぜ中間テーブルが必要か？】
# - Userテーブルに「いいねしたアクションプラン一覧」を持たせると
#   データ構造が複雑になる（配列を持つことになる）
# - PostEntryテーブルに「いいねしたユーザー一覧」を持たせても同じ問題
# - 中間テーブルを使えば、シンプルな「1対多」の関係で表現できる
#
class EntryLike < ApplicationRecord
  # ==========================================
  # アソシエーション（他テーブルとの関連）
  # ==========================================
  #
  # 【belongs_to とは？】
  # 「このレコードは○○に属している」という関係を定義する。
  # 外部キー（user_id, post_entry_id）がこのテーブルに保存される。
  #

  # いいねしたユーザー
  # entry_like.user でいいねしたユーザーを取得できる
  belongs_to :user

  # いいねされたアクションプラン
  # entry_like.post_entry でいいねされたプランを取得できる
  belongs_to :post_entry

  # ==========================================
  # バリデーション（データの検証ルール）
  # ==========================================
  #
  # 【uniqueness とは？】
  # 一意性の検証。同じ値が2つ以上存在しないことを保証する。
  #
  # 【scope: :post_entry_id とは？】
  # 「post_entry_id と組み合わせて一意」という意味。
  # つまり「同じユーザーが同じアクションプランに2回いいねできない」。
  #
  # 例:
  # - user_id=1, post_entry_id=1 が存在する状態で
  # - user_id=1, post_entry_id=1 を作ろうとする → エラー（重複）
  # - user_id=1, post_entry_id=2 を作る → OK（別のプランなので）
  # - user_id=2, post_entry_id=1 を作る → OK（別のユーザーなので）
  #
  validates :user_id, uniqueness: { scope: :post_entry_id }
end
