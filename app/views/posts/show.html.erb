<%# app/views/posts/show.html.erb %>
<%# ÂãïÁîªË©≥Á¥∞„Éö„Éº„Ç∏Ôºà„Ç∑„É≥„Éó„É´ÁâàÔºâ %>
<% content_for :title, @post.youtube_title&.truncate(30) || "ÂãïÁîªË©≥Á¥∞" %>

<div class="min-h-screen bg-white">
  <%# ===== „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢Ôºà620pxÂπÖ„Éª‰∏≠Â§ÆÈÖçÁΩÆÔºâ ===== %>
  <div style="max-width: 620px; margin: 0 auto; padding: 0 20px;">

    <%# Êàª„Çã„Éú„Çø„É≥ %>
    <div class="py-4">
      <% back_path = params[:from] == 'mypage' ? mypage_path : posts_path %>
      <%= link_to back_path, class: "inline-flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 transition-colors" do %>
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
        <span>Êàª„Çã</span>
      <% end %>
    </div>

    <%# ===== „Éí„Éº„É≠„Éº: YouTube „Çµ„É†„Éç„Ç§„É´ ===== %>
    <%= link_to @post.youtube_url,
          target: "_blank",
          rel: "noopener noreferrer",
          class: "block relative group mb-8" do %>
      <div class="aspect-video w-full rounded-lg overflow-hidden bg-gray-100">
        <%= image_tag @post.youtube_thumbnail_url(size: :hqdefault),
              alt: @post.youtube_title,
              class: "w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",
              loading: "lazy",
              onerror: "this.src='#{@post.youtube_thumbnail_url(size: :mqdefault)}'" %>
      </div>
      <%# ÂÜçÁîü„Éú„Çø„É≥ %>
      <div class="absolute inset-0 flex items-center justify-center">
        <div class="w-14 h-14 bg-black/60 rounded-full flex items-center justify-center group-hover:bg-gray-700 group-hover:scale-110 transition-all duration-300">
          <svg class="w-6 h-6 text-white ml-0.5" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </div>
      </div>
      <%# YouTube „É©„Éô„É´ %>
      <div class="absolute top-3 left-3 flex items-center gap-1.5 bg-black/60 text-white text-xs px-2 py-1 rounded">
        <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
        </svg>
        <span>YouTube„ÅßË¶ã„Çã</span>
      </div>
    <% end %>

    <%# ===== „Çø„Ç§„Éà„É´ ===== %>
    <h1 style="font-size: 22px; font-weight: 700; color: #1a1a1a; line-height: 1.4; margin-bottom: 12px;">
      <%= @post.youtube_title %>
    </h1>

    <%# ===== „ÉÅ„É£„É≥„Éç„É´Âêç ===== %>
    <% if @post.youtube_channel_name.present? %>
      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
        <% if @post.youtube_channel_thumbnail_url.present? %>
          <%= image_tag @post.youtube_channel_thumbnail_url,
                style: "width: 24px; height: 24px; border-radius: 50%; object-fit: cover;",
                alt: @post.youtube_channel_name,
                loading: "lazy" %>
        <% else %>
          <div style="width: 24px; height: 24px; border-radius: 50%; background: #e5e7eb; display: flex; align-items: center; justify-content: center;">
            <svg style="width: 14px; height: 14px; color: #9ca3af;" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
          </div>
        <% end %>
        <p style="font-size: 14px; color: #6b7280;">
          <%= @post.youtube_channel_name %>
        </p>
      </div>
    <% end %>

    <%# ===== „É¶„Éº„Ç∂„ÉºÊï∞ & „É©„É≥„Ç≠„É≥„Ç∞ ===== %>
    <div class="mb-5" style="display: flex; align-items: center; gap: 8px;">
      <span class="text-xs text-gray-400"><%= @post.entry_users.count %> „É¶„Éº„Ç∂„Éº„Åå„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥„ÇíÊäïÁ®ø</span>
      <% if (rank = @post.action_count_rank) %>
        <span style="display: inline-flex; align-items: center; padding: 2px 8px; background: #f3f4f6; border-radius: 10px; font-size: 11px; font-weight: 600; color: #374151;">
          TOP <%= rank %>
        </span>
      <% end %>
    </div>

    <%# ===== „Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥„Çª„ÇØ„Ç∑„Éß„É≥ ===== %>
    <section style="border-top: 1px solid #f3f4f6; padding-top: 32px; margin-bottom: 32px;">
      <h2 style="font-size: 18px; font-weight: 700; color: #1a1a1a; margin-bottom: 24px; display: flex; align-items: center; gap: 8px;">
        <span>üéØ</span>
        <span>„Åø„Çì„Å™„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥</span>
        <span style="font-size: 14px; font-weight: 400; color: #9ca3af;">(<%= @post.post_entries.count %>)</span>
      </h2>

      <%# ===== AIÊèêÊ°à„Çª„ÇØ„Ç∑„Éß„É≥ÔºàËá™ÂãïÂèñÂæóÔºâ ===== %>
      <% if user_signed_in? %>
        <div id="ai-suggestions-container" style="margin-bottom: 20px;" data-controller="ai-suggestions" data-ai-suggestions-url-value="<%= suggest_action_plans_post_path(@post) %>">
          <%# „É≠„Éº„Éá„Ç£„É≥„Ç∞ÔºàÊúÄÂàù„Å´Ë°®Á§∫Ôºâ %>
          <div id="ai-suggestions-loading" data-ai-suggestions-target="loading" style="padding: 16px; background: #f9fafb; border-radius: 12px; text-align: center;">
            <div style="display: inline-flex; align-items: center; gap: 8px; color: #6b7280; font-size: 14px;">
              <svg style="width: 18px; height: 18px; animation: spin 1s linear infinite;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
              </svg>
              <span>AI„Åå„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥„ÇíËÄÉ„Åà‰∏≠...</span>
            </div>
          </div>

          <%# ÊèêÊ°à‰∏ÄË¶ß %>
          <div id="ai-suggestions-list" data-ai-suggestions-target="list" style="display: none;"></div>
        </div>
      <% end %>

      <%# „Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥ÊäïÁ®ø„Éï„Ç©„Éº„É†Ôºà„É≠„Ç∞„Ç§„É≥„É¶„Éº„Ç∂„Éº„ÅÆ„ÅøÔºâ %>
      <% if user_signed_in? %>
        <%# ÊäïÁ®ø„Éï„Ç©„Éº„É†Ôºà„Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞ÂÖ•Âäõ„Éê„Éº„ÉªËá™ÂãïÊã°ÂºµÔºâ- Ë§áÊï∞ÊäïÁ®øÂèØËÉΩ %>
        <div style="background: #f3f4f6; border-radius: 20px; padding: 10px 12px; margin-bottom: 20px;">
          <%= form_with url: post_post_entries_path(@post), method: :post, local: true do %>
            <div style="display: flex; gap: 10px; align-items: flex-start;">
              <%# „Ç¢„Éê„Çø„Éº %>
              <div style="flex-shrink: 0; padding-top: 2px;">
                <% if current_user.avatar.present? %>
                  <%= image_tag current_user.avatar.url, style: "width: 32px; height: 32px; border-radius: 50%; object-fit: cover;" %>
                <% else %>
                  <div style="width: 32px; height: 32px; border-radius: 50%; background: #374151; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 12px;">
                    <%= current_user.name&.first&.upcase || '?' %>
                  </div>
                <% end %>
              </div>

              <%# ÂÖ•ÂäõÊ¨ÑÔºàËá™ÂãïÊã°ÂºµtextareaÔºâ %>
              <textarea name="post_entry[content]" required rows="1"
                        placeholder="„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥„ÇíÊõ∏„Åè..."
                        oninput="this.style.height='auto'; this.style.height=this.scrollHeight+'px';"
                        style="flex: 1; min-width: 0; padding: 6px 0; font-size: 16px; line-height: 1.5; color: #1f2937; background: transparent; border: none; outline: none; resize: none; overflow: hidden;"></textarea>

              <%# Âè≥ÂÅ¥„Éú„Çø„É≥Áæ§ %>
              <div style="display: flex; align-items: center; gap: 16px; flex-shrink: 0; padding-top: 2px;">
                <%# ÊúüÈôêÔºàÂøÖÈ†àÔºâ %>
                <div style="position: relative; width: 32px; height: 32px;">
                  <input type="date" name="post_entry[deadline]"
                         id="deadline-input-<%= @post.id %>"
                         required
                         style="position: absolute; top: 0; left: 0; width: 32px; height: 32px; opacity: 0; cursor: pointer; font-size: 16px;">
                  <label for="deadline-input-<%= @post.id %>" style="cursor: pointer; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px;" title="ÊúüÈôê„ÇíË®≠ÂÆöÔºàÂøÖÈ†àÔºâ">
                    <svg style="width: 20px; height: 20px; color: #6b7280;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"/>
                    </svg>
                  </label>
                </div>

                <%# ÈÄÅ‰ø°„Éú„Çø„É≥ %>
                <button type="submit" style="width: 32px; height: 32px; border-radius: 50%; background: #374151; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                  <svg style="width: 16px; height: 16px; color: white;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M5 12h14M12 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <%# Êú™„É≠„Ç∞„Ç§„É≥ %>
        <div class="flex gap-2 mb-6">
          <div class="flex-shrink-0" style="width: 44px; height: 44px;">
            <div style="width: 44px; height: 44px; border-radius: 50%; background: #e5e7eb; display: flex; align-items: center; justify-content: center;">
              <svg style="width: 24px; height: 24px; color: #9ca3af;" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
            </div>
          </div>
          <div class="flex-1 min-w-0">
            <div class="text-xs text-gray-500 mb-1">„Ç≤„Çπ„Éà</div>
            <div class="relative inline-block">
              <div class="absolute -left-2 top-3">
                <div style="width: 0; height: 0; border-top: 8px solid transparent; border-bottom: 8px solid transparent; border-right: 10px solid white;"></div>
              </div>
              <div class="bg-white rounded-[18px] rounded-tl-sm shadow-[0_1px_2px_rgba(0,0,0,0.1)] px-4 py-3">
                <p class="text-[15px] text-gray-600 mb-2">„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥„ÇíÊäïÁ®ø„Åó„Çà„ÅÜ</p>
                <%= link_to "„É≠„Ç∞„Ç§„É≥", new_user_session_path, class: "text-sm font-medium text-gray-700 hover:text-gray-900 underline" %>
              </div>
            </div>
          </div>
        </div>
      <% end %>

      <%# Êó¢Â≠ò„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥‰∏ÄË¶ß %>
      <% if @post.post_entries.any? %>
        <div class="overflow-hidden">
          <% @post.post_entries.recent.each do |entry| %>
            <%= render 'post_entries/entry_card', entry: entry %>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8 px-4 bg-gray-50 rounded-2xl">
          <div class="text-4xl mb-3 opacity-50">üí≠</div>
          <p class="text-sm text-gray-500">„Åæ„Å†„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
          <p class="text-xs text-gray-400 mt-1">ÊúÄÂàù„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥„ÇíÊäïÁ®ø„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</p>
        </div>
      <% end %>
    </section>

    <%# ‰∏ãÈÉ®‰ΩôÁôΩ %>
    <div style="height: 40px;"></div>
  </div>
</div>
