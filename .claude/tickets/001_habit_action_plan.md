# 習慣型アクションプラン機能

## 概要

現在の単発型アクションプランに加え、複数日にわたる習慣化をサポートする機能を追加する。

## ユーザーストーリー

```
ユーザーとして、
「3日間毎朝腹筋10回を続ける」のような習慣化目標を設定し、
毎日の達成/未達成を記録して可視化したい。
なぜなら、継続的な行動変容を追跡したいから。
```

## 機能要件

### 1. アクションプラン作成時

- [ ] 「単発」「習慣」を選択できるUIを追加
- [ ] 習慣選択時、期間（日数）を入力できるフィールドを追加
  - デフォルト: 3日
  - 最大: 30日

### 2. 習慣型アクションプランの達成記録

- [ ] 毎日の達成/未達成をトグルできるUI
- [ ] 期間内の各日に対して個別に記録
- [ ] 日付ごとのステータス: 達成 / 未達成 / 未記録

### 3. 達成状況の可視化

- [ ] カレンダー形式で達成状況を表示
  - 達成: 緑色
  - 未達成: 赤色
  - 未記録: グレー
- [ ] 連続達成日数の表示
- [ ] 達成率（達成日数 / 経過日数）の表示

### 4. マイページでの表示

- [ ] 習慣型アクションプランを専用セクションで表示
- [ ] 進行中の習慣一覧
- [ ] 完了した習慣の履歴

## データベース設計（案）

### post_entries への追加カラム

```ruby
add_column :post_entries, :entry_mode, :integer, default: 0
# 0: single (単発), 1: habit (習慣)

add_column :post_entries, :habit_duration, :integer
# 習慣の期間（日数）
```

### 新規テーブル: habit_records

```ruby
create_table :habit_records do |t|
  t.references :post_entry, null: false, foreign_key: true
  t.date :target_date, null: false
  t.integer :status, default: 0  # 0: unrecorded, 1: achieved, 2: failed
  t.timestamps
end

add_index :habit_records, [:post_entry_id, :target_date], unique: true
```

## UI設計（案）

### 作成フォーム

```
┌─────────────────────────────────────┐
│ アクションプランの種類              │
│ ○ 単発（1回達成で完了）            │
│ ● 習慣（複数日継続）               │
│                                     │
│ 期間: [3] 日間                      │
│                                     │
│ アクションプラン:                   │
│ ┌─────────────────────────────────┐ │
│ │ 毎朝腹筋10回を続ける            │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 達成記録UI

```
┌─────────────────────────────────────┐
│ 「毎朝腹筋10回を続ける」(3日間)     │
│                                     │
│  1日目(1/21)  2日目(1/22)  3日目(1/23)
│     ✅           ❌           ⬜     │
│                                     │
│ 達成率: 50% (1/2日)                 │
│ 連続: 0日                           │
└─────────────────────────────────────┘
```

## 実装ステップ

1. **Phase 1: データベース準備**
   - マイグレーション作成
   - モデル追加・修正
   - テスト作成

2. **Phase 2: 作成フォーム**
   - 種類選択UI
   - 期間入力フィールド
   - バリデーション

3. **Phase 3: 達成記録機能**
   - 日別達成トグルUI
   - HabitRecordの作成・更新
   - Turbo Streamでリアルタイム更新

4. **Phase 4: 可視化**
   - カレンダー表示
   - 達成率・連続日数計算
   - マイページ統合

## 注意事項

- 既存の単発型アクションプランとの互換性を維持
- 習慣記録は開始日から順番に入力（未来の日付は入力不可）
- 期間終了後は習慣全体として「達成/未達成」を判定
