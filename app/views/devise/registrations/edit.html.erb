<%#
  app/views/devise/registrations/edit.html.erb
  ==========================================
  アカウント設定ページ
  ==========================================

  【このページの役割】
  ログイン済みユーザーがアカウント情報を変更するページ。
  メールアドレス変更、パスワード変更、アカウント削除が可能。

  【アクセス方法】
  マイページ → 設定アイコン など

  【フォーム送信先】
  PUT /users → Devise::RegistrationsController#update

  【セクション構成】
  1. メールアドレス変更
  2. パスワード変更（任意）
  3. 現在のパスワード入力（必須）
  4. アカウント削除

  【使用されるパーシャル】
  - devise/shared/_error_messages: エラー表示
  - shared/_password_field: パスワード入力（表示切替付き）

  【現在のパスワード】
  セキュリティのため、変更を保存するには
  現在のパスワードの入力が必要。

  【アカウント削除】
  button_to + method: :delete で DELETE リクエスト送信。
  data: { confirm: "..." } で確認ダイアログ表示。
%>
<% content_for :title, "アカウント設定" %>

<div class="min-h-screen bg-gray-50">
  <div class="max-w-2xl mx-auto px-4 py-6">

    <%# 戻るリンク %>
    <div class="mb-6">
      <%= link_to :back, class: "inline-flex items-center gap-2 text-gray-500 hover:text-gray-700 transition-colors" do %>
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"/>
        </svg>
        <span>戻る</span>
      <% end %>
    </div>

    <%# フォームタイトル %>
    <div class="text-center mb-8">
      <h1 class="text-2xl font-bold text-gray-900">アカウント設定</h1>
      <p class="mt-2 text-gray-500">アカウント情報を更新できます</p>
    </div>

    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put, class: "space-y-6", data: { turbo: false } }) do |f| %>
      <%= render "devise/shared/error_messages", resource: resource %>

      <%# メールアドレス %>
      <div>
        <%= f.label :email, "メールアドレス", class: "block text-sm font-semibold text-gray-900 mb-2" %>
        <%= f.email_field :email, autofocus: true, autocomplete: "email",
              class: "w-full px-4 py-3 rounded-xl border border-gray-300 text-gray-900 placeholder-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500 transition-colors" %>
      </div>

      <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
        <div class="bg-amber-50 border border-amber-200 rounded-xl p-4">
          <p class="text-sm text-amber-700">
            <span class="font-medium">確認待ち:</span> <%= resource.unconfirmed_email %>
          </p>
        </div>
      <% end %>

      <%# パスワード変更セクション %>
      <div class="pt-6 border-t border-gray-200">
        <h3 class="text-base font-bold text-gray-900 mb-2">パスワード変更</h3>
        <p class="text-sm text-gray-500 mb-4">変更しない場合は空欄のままにしてください</p>

        <div class="space-y-4">
          <%= render 'shared/password_field',
                form: f,
                field_name: :password,
                label_text: "新しいパスワード",
                placeholder: "新しいパスワードを入力",
                autocomplete: "new-password",
                show_hint: true,
                minimum_length: @minimum_password_length || 6 %>

          <%= render 'shared/password_field',
                form: f,
                field_name: :password_confirmation,
                label_text: "新しいパスワード（確認用）",
                placeholder: "新しいパスワードを再入力",
                autocomplete: "new-password" %>
        </div>
      </div>

      <%# 現在のパスワード %>
      <div class="pt-6 border-t border-gray-200">
        <%= render 'shared/password_field',
              form: f,
              field_name: :current_password,
              label_text: "現在のパスワード",
              placeholder: "現在のパスワードを入力",
              autocomplete: "current-password" %>
        <p class="text-xs text-gray-500 mt-1">変更を保存するには現在のパスワードが必要です</p>
      </div>

      <%# 更新ボタン %>
      <div class="pt-4">
        <%= f.submit "更新する",
              class: "w-full bg-gray-900 text-white py-3 px-4 rounded-xl font-semibold hover:bg-gray-700 transition-colors cursor-pointer" %>
      </div>
    <% end %>

    <%# アカウント削除セクション %>
    <div class="mt-8 pt-8 border-t border-gray-200">
      <h3 class="text-base font-bold text-red-600 mb-2">アカウント削除</h3>
      <p class="text-sm text-gray-500 mb-4">アカウントを削除すると、すべてのデータが完全に削除されます。この操作は取り消せません。</p>
      <%= button_to "アカウントを削除する", registration_path(resource_name),
            method: :delete,
            data: { turbo: false, confirm: "本当にアカウントを削除しますか？この操作は取り消せません。" },
            class: "inline-flex items-center gap-2 px-4 py-2 rounded-xl border border-red-300 text-red-600 font-medium hover:bg-red-50 transition-colors" %>
    </div>

  </div>
</div>
