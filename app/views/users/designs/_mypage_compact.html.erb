<%# app/views/users/designs/_mypage_compact.html.erb %>
<%# „Éá„Ç∂„Ç§„É≥B: „Ç≥„É≥„Éë„ÇØ„ÉàÁâà %>
<%# „Éó„É≠„Éï„Ç£„Éº„É´Ê®™‰∏¶„Å≥ + ÂãïÁîªÂ∞è„Åï„ÇÅ + „Ç¢„ÇØ„Ç∑„Éß„É≥ %>

<% current_action = user.current_action_plan %>
<% current_video = user.current_video %>

<div class="max-w-md mx-auto px-4 py-6">
  <%# „Éó„É≠„Éï„Ç£„Éº„É´ÔºàÊ®™‰∏¶„Å≥„Éª„Ç≥„É≥„Éë„ÇØ„ÉàÔºâ %>
  <div class="flex items-center gap-3 mb-6">
    <% if user.avatar.present? %>
      <%= image_tag user.avatar.url, class: "w-12 h-12 rounded-full object-cover flex-shrink-0" %>
    <% else %>
      <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0">
        <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
        </svg>
      </div>
    <% end %>
    <div class="flex-1 min-w-0">
      <div class="flex items-center gap-1">
        <h1 class="text-lg font-bold text-gray-900 truncate"><%= user.name.presence || "ÂêçÁÑ°„Åó„Åï„Çì" %></h1>
        <%= link_to edit_profile_path, class: "p-1 text-gray-400 hover:text-gray-600" do %>
          <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
          </svg>
        <% end %>
      </div>
      <p class="text-xs text-gray-500"><%= user.post_entries.achieved.count %> „Ç¢„ÇØ„Ç∑„Éß„É≥ÈÅîÊàê</p>
    </div>
  </div>

  <% if current_video && current_action %>
    <%# ÂãïÁîªÔºàÂ∞è„Åï„ÇÅ„Çµ„É†„Éç„Ç§„É´Ôºâ+ „Ç¢„ÇØ„Ç∑„Éß„É≥„ÇíÊ®™‰∏¶„Å≥ %>
    <div class="bg-gray-50 rounded-xl p-3" data-controller="hero-video" data-hero-video-video-id-value="<%= current_video.youtube_video_id %>">
      <div class="flex gap-3">
        <%# ÂãïÁîª„Çµ„É†„Éç„Ç§„É´ %>
        <div class="flex-shrink-0 w-32 group relative cursor-pointer rounded-lg overflow-hidden" style="aspect-ratio: 16/9;">
          <iframe
            id="hero-player-<%= current_video.youtube_video_id %>"
            data-hero-video-target="iframe"
            src="https://www.youtube.com/embed/<%= current_video.youtube_video_id %>?autoplay=1&mute=1&loop=1&playlist=<%= current_video.youtube_video_id %>&controls=0&playsinline=1&rel=0&modestbranding=1&showinfo=0&enablejsapi=1"
            class="absolute inset-0 w-full h-full pointer-events-none"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
          </iframe>
          <div class="absolute inset-0 z-10 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"
               data-action="click->hero-video#toggle">
            <div class="absolute inset-0 bg-black/30"></div>
            <button type="button" class="relative z-10 w-8 h-8 rounded-full bg-white/90 flex items-center justify-center">
              <svg data-hero-video-target="playButton" class="w-4 h-4 text-black ml-0.5 hidden" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z"/>
              </svg>
              <svg data-hero-video-target="pauseButton" class="w-4 h-4 text-black" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
              </svg>
            </button>
          </div>
        </div>

        <%# ÂãïÁîªÊÉÖÂ†± + „Ç¢„ÇØ„Ç∑„Éß„É≥ %>
        <div class="flex-1 min-w-0">
          <%= link_to post_path(current_video), class: "block group/info" do %>
            <h3 class="text-sm font-bold text-gray-900 line-clamp-2 group-hover/info:text-gray-600 leading-snug">
              <%= current_video.youtube_title %>
            </h3>
            <p class="text-xs text-gray-500 mt-1 truncate"><%= current_video.youtube_channel_name %></p>
          <% end %>
        </div>
      </div>

      <%# „Ç¢„ÇØ„Ç∑„Éß„É≥ %>
      <div class="mt-3 pt-3 border-t border-gray-200">
        <div class="flex items-start gap-2">
          <%= button_to achieve_post_post_entry_path(current_video, current_action),
                method: :patch, class: "flex-shrink-0 mt-0.5",
                form: { data: { turbo_confirm: "ÈÅîÊàê„Åó„Åæ„Åô„ÅãÔºü", turbo_frame: "_top" } } do %>
            <div class="w-5 h-5 rounded-full border-2 border-gray-900 cursor-pointer hover:bg-gray-200 transition-colors"></div>
          <% end %>
          <div class="flex-1 min-w-0">
            <p class="text-sm text-gray-900 leading-relaxed"><%= current_action.content %></p>
            <% if current_action.deadline.present? %>
              <% is_overdue = current_action.deadline < Date.current %>
              <% is_today = current_action.deadline == Date.current %>
              <p class="text-xs mt-0.5 <%= is_overdue ? 'text-red-500' : (is_today ? 'text-gray-900' : 'text-gray-400') %>">
                <%= is_overdue ? 'ÊúüÈôêÂàá„Çå' : (is_today ? '‰ªäÊó•' : l(current_action.deadline, format: :short)) %>
              </p>
            <% end %>
          </div>
          <%= button_to post_post_entry_path(current_video, current_action),
                method: :delete,
                form: { data: { turbo_confirm: "ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü", turbo_frame: "_top" } },
                class: "flex-shrink-0 text-gray-300 hover:text-red-500" do %>
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          <% end %>
        </div>
      </div>
    </div>
  <% else %>
    <div class="bg-gray-50 rounded-xl py-12 px-4 text-center">
      <div class="text-4xl mb-3">üéØ</div>
      <p class="text-sm text-gray-500 mb-4">„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
      <%= link_to posts_path, class: "inline-flex px-4 py-2 bg-gray-900 text-white text-sm rounded-full font-medium hover:bg-gray-700" do %>
        ÂãïÁîª„ÇíÊé¢„Åô
      <% end %>
    </div>
  <% end %>
</div>
