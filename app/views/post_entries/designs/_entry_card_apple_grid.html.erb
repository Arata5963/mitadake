<%# app/views/post_entries/designs/_entry_card_apple_grid.html.erb %>
<%# Apple Reminders風デザイン - 2カラムグリッド版 %>

<%= turbo_frame_tag dom_id(entry) do %>
<article class="group" style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); overflow: hidden;">
  <div style="padding: 12px 14px;">
    <div style="display: flex; align-items: flex-start; gap: 12px;">

      <%# チェックボックス %>
      <div style="flex-shrink: 0; padding-top: 1px;">
        <% if user_signed_in? && entry.user == current_user && !entry.achieved? %>
          <%= button_to achieve_post_post_entry_path(entry.post, entry),
                method: :patch,
                class: "block",
                form: { data: { turbo_confirm: "「#{truncate(entry.content, length: 20)}」を達成しますか？" } } do %>
            <div style="width: 20px; height: 20px; border-radius: 50%; border: 2px solid #007aff; cursor: pointer; transition: all 0.2s ease;"
                 onmouseover="this.style.backgroundColor='rgba(0,122,255,0.1)';"
                 onmouseout="this.style.backgroundColor='transparent';"></div>
          <% end %>
        <% elsif entry.achieved? %>
          <div style="width: 20px; height: 20px; border-radius: 50%; background: #007aff; display: flex; align-items: center; justify-content: center;">
            <svg style="width: 11px; height: 11px; color: white;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
            </svg>
          </div>
        <% else %>
          <div style="width: 20px; height: 20px; border-radius: 50%; border: 2px solid #c7c7cc;"></div>
        <% end %>
      </div>

      <%# コンテンツ %>
      <div style="flex: 1; min-width: 0;">
        <%# テキスト %>
        <p style="font-size: 15px; line-height: 1.35; color: <%= entry.achieved? ? '#8e8e93' : '#000' %>; margin: 0; -webkit-font-smoothing: antialiased; <%= 'text-decoration: line-through;' if entry.achieved? %> display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
          <%= entry.content %>
        </p>

        <%# サブ情報（コンパクト） %>
        <div style="display: flex; align-items: center; gap: 8px; margin-top: 6px; flex-wrap: wrap;">
          <%# 期限 %>
          <% if entry.deadline.present? %>
            <%
              is_overdue = entry.deadline < Date.current && !entry.achieved?
              is_today = entry.deadline == Date.current
              date_color = is_overdue ? '#ff3b30' : (is_today ? '#007aff' : '#8e8e93')
            %>
            <div style="display: flex; align-items: center; gap: 4px;">
              <svg style="width: 12px; height: 12px; color: <%= date_color %>;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <span style="font-size: 11px; color: <%= date_color %>;">
                <%= is_today ? '今日' : l(entry.deadline, format: :short) %>
              </span>
            </div>
          <% end %>

          <%# 投稿者 %>
          <div style="display: flex; align-items: center; gap: 4px;">
            <% if entry.display_avatar.present? %>
              <%= image_tag entry.display_avatar.url, style: "width: 14px; height: 14px; border-radius: 50%; object-fit: cover;" %>
            <% end %>
            <span style="font-size: 11px; color: #8e8e93;"><%= entry.display_user_name %></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%# ホバー時のアクションバー %>
  <div class="opacity-0 group-hover:opacity-100 transition-opacity" style="position: absolute; top: 8px; right: 8px; display: flex; gap: 4px;">
    <%= link_to post_path(entry.post), style: "width: 24px; height: 24px; border-radius: 50%; background: #f2f2f7; display: flex; align-items: center; justify-content: center; text-decoration: none;", data: { turbo_frame: "_top" }, title: "動画" do %>
      <svg style="width: 12px; height: 12px; color: #007aff;" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
      </svg>
    <% end %>

    <% if user_signed_in? && entry.user == current_user %>
      <%= button_to post_post_entry_path(entry.post, entry),
            method: :delete,
            data: { turbo_confirm: "削除しますか？" },
            style: "width: 24px; height: 24px; border-radius: 50%; background: #f2f2f7; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;",
            title: "削除" do %>
        <svg style="width: 12px; height: 12px; color: #ff3b30;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      <% end %>
    <% end %>
  </div>
</article>
<% end %>
